# 统一错误码字典（看板/任务/工时/迭代/报表）

说明：所有错误响应均遵循 ErrorResponse 模型：

- code：稳定的机器可读错误码（字符串），用于客户端逻辑与监控。
- message：人类可读的简述，面向终端用户或开发者。
- details：结构化细节（对象或数组），用于指示具体字段错误或上下文。
- requestId：请求唯一标识，便于审计与排障。

示例：

```
{
  "code": "E_WORKLOG_OVERLAP",
  "message": "Worklog time range overlaps with existing records",
  "details": { "existing": { "startAt": "2025-10-29T09:30:00Z", "endAt": "2025-10-29T10:15:00Z" } },
  "requestId": "req_20251029_00001"
}
```

## 通用错误

- E_BAD_REQUEST（400）：请求参数不合法或缺失。
- E_UNAUTHORIZED（401）：缺少或无效的认证。
- E_FORBIDDEN（403）：权限不足或资源越权访问。
- E_NOT_FOUND（404）：资源不存在（如 board/task/sprint/worklog）。
- E_CONFLICT（409）：资源冲突（如重复创建、状态不一致）。
- E_RATE_LIMITED（429）：触发限流，响应头含 Retry-After 与 X-RateLimit-*。
- E_PAYLOAD_TOO_LARGE（413）：请求体或附件过大。
- E_UNPROCESSABLE_ENTITY（422）：语义校验失败（字段值违反业务约束）。

## 看板与任务

- E_BOARD_NOT_FOUND（404）：看板不存在或不可见。
- E_BOARD_SCOPE_INVALID（400/422）：看板 scopeType/visibility 不合法或与租户策略冲突。
- E_COLUMN_KEY_CONFLICT（409）：列 key 重复或已存在。
- E_COLUMN_ORDER_DUP（409）：列排序号重复或不合法。
- E_TASK_NOT_FOUND（404）：任务不存在或不可见。
- E_TASK_COLUMN_INVALID（400/422）：任务所属列无效（不存在或不属于看板）。
- E_ASSIGNEE_INVALID（400/422）：负责人不存在、越权或不在团队内。
- E_ESTIMATE_INVALID（400/422）：估时值不合法（负数或超出限制）。
- E_LABEL_INVALID（400/422）：标签不合法或超出数量限制。
- E_IDEMPOTENCY_REPLAY（409）：幂等键重复请求且与首次请求参数不一致。

## 工时

- E_WORKLOG_TASK_NOT_FOUND（404）：关联任务不存在。
- E_WORKLOG_USER_NOT_FOUND（404）：关联用户不存在或不可用。
- E_WORKLOG_DURATION_INVALID（400/422）：时长或起止时间不合法（负数、起止倒置）。
- E_WORKLOG_OVERLAP（409/422）：时间区间与既有记录重叠。
- E_WORKLOG_BILLING_INVALID（400/422）：计费标记或货币/渠道字段不合法。

## 迭代与燃尽

- E_SPRINT_NOT_FOUND（404）：迭代不存在或不可见。
- E_SPRINT_DATE_INVALID（400/422）：迭代起止日期不合法、越界或与看板工作日配置冲突。
- E_SPRINT_OVERLAP（409/422）：同一看板下迭代时间范围重叠。
- E_SPRINT_TZ_INVALID（400/422）：时区设置不合法或不被支持。

## 报表

- E_REPORT_TYPE_INVALID（400）：报表类型不受支持或拼写错误。
- E_FILTER_INVALID（400/422）：filters 字段不合法或缺少必填维度。
- E_REPORT_EMPTY（404/204）：指定范围内无数据；返回空快照或 204。

## 触发限流（429）与重试

- 当返回 E_RATE_LIMITED（429）时，响应头包含：
  - X-RateLimit-Limit/X-RateLimit-Remaining/X-RateLimit-Reset
  - Retry-After：重试等待秒数（整数）
- 客户端应遵循指数退避与最大重试次数策略；写操作需配合 Idempotency-Key，避免重复副作用。

## 字段级错误 details 约定

- details.fieldErrors：数组形式，元素包含 { field, issue, hint }。
- details.conflicts：冲突上下文，如 { resource, key, currentValue, expected }。
- details.scope：越权或租户边界信息，如 { tenantId, requiredScope }。

## 版本与扩展

- 本字典随 OpenAPI 版本化（3.1），新增错误码以向后兼容方式引入（不改变既有语义）。
- 对外 SDK 与契约测试工具将依据该错误码字典进行断言与提示。

