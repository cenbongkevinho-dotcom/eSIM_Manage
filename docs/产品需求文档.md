# eSIM_Manage 平台需求文档（基于 GSMA 标准）

版本：v0.1（草案）  
状态：进行中  
作者：项目组  
最后更新：2025-10-29

## 1. 文档目的与范围

本文档用于明确 eSIM_Manage 平台的产品需求与业务范围，确保平台在功能、流程、合规与非功能方面满足 GSMA eSIM 远程配置（RSP）架构要求，并支撑以下核心能力：

- 运营商接入与管理（支持 Consumer/IoT/M2M 场景）
- 套餐与流量池管理（B2B/B2C）
- 批发与零售的套餐管理与渠道分销
- 客户与订阅生命周期管理（eUICC/eSIM Profile）
- 财务管理（计费/开票/支付/结算/税务）
- 产品管理（SKU/组合包/促销）
- 市场竞价策略分析（动态定价与仿真）
- 合规、安全与审计（基于 GSMA RSP 与当地法规）

## 2. 术语与缩写

- eUICC：嵌入式通用集成电路卡（即 eSIM 芯片/卡）
- eSIM Profile：运营商配置文件，包含 IMSI/ICCID 等网络接入所需信息
- LPA：本地配置代理（Local Profile Assistant，终端侧引导激活）
- SM-DP+：消费者场景的 Profile 下载平台（Subscription Manager Data Preparation+）
- SM-DS：发现服务（Discovery Service）
- SM-DP / SM-SR：M2M 场景的数据准备与安全路由管理
- EID：eUICC 标识符（eUICC Identifier）
- ICCID / IMSI / MSISDN：卡号/国际移动用户识别码/号码
- Activation Code（激活码）：通常使用“LPA:1$<SM-DP+ 地址>$<MatchingID>$<可选参数>”格式的激活字符串
- Matching ID：用于在 SM-DP+ 上匹配 Profile 与设备的标识
- RSP：远程 SIM 配置（Remote SIM Provisioning）

提示：平台遵循 GSMA eSIM RSP 标准及其 SGP 系列规范（如适用，涵盖 Consumer 的 SM-DP+/SM-DS 与 M2M 的 SM-DP/SM-SR），并根据运营商实际接口对接。

## 3. 目标与业务范围

### 3.1 目标

- 为全球/区域性运营商、渠道商与企业客户提供一站式 eSIM 管理平台。
- 快速、合规地完成 eSIM Profile 的订购、分发、激活、生命周期维护与计费结算。
- 支持多渠道（批发、零售、企业直采）、多货币、多税制，具备可观测与审计能力。

### 3.2 范围

- 支持 Consumer 场景的激活码分发、LPA 流程与 SM-DP+ 回调。
- 支持 B2B 企业的批量激活与流量池共享（数据配额分配/扩容/告警）。
- 支持批发价目表与零售价格策略、合作伙伴门户与 API。
- 支持计费与财务闭环（账单、支付、税率、汇率、结算）。

## 4. 用户角色与权限（RBAC）

- 超级管理员（Platform Admin）：平台全局配置、运营商接入、系统参数、安全策略。
- 运营商管理员（Carrier Admin）：运营商入驻、Profile 目录、价目表与 SLA、对账。
- 企业管理员（Enterprise Admin）：企业账户、流量池、批量订单、成员与设备管理。
- 零售渠道管理员（Reseller Admin）：零售套餐管理、渠道价与促销、订单履约。
- 财务人员（Finance）：计费配置、开票、支付、结算与对账。
- 客服与运营（Support/OPS）：工单处理、退换、激活问题定位与报表。
- 市场分析师（Marketing Analyst）：竞价策略、价格仿真、A/B 测试与监控。
- 终端用户（End User）：查看订单、获取激活码、自助激活与售后。

## 5. 功能需求

### 5.1 运营商接入（Carrier Onboarding）

- 运营商信息管理：法人信息、证书、端点、支持区域与网络能力（2G/3G/4G/5G）。
- 接入方式：支持 Consumer（SM-DP+/SM-DS）与 M2M（SM-DP/SM-SR）接口协议；双向证书与 mTLS。
- 沙盒/生产环境切换：测试数据集、验收流程与回归范式。
- 价目表与库存：导入运营商可用 Profile 类型、区域/有效期/容量/成本、上限与补货策略。
- SLA 管理与告警：回调延迟、下载失败率、安装成功率、可用库存阈值告警。
- Webhook 回调：接收 SM-DP+ 状态通知（如 Profile 可下载/已下载/已安装/启用/禁用/删除）。

### 5.2 套餐与流量池管理

- 套餐定义：数据/语音/短信、适用区域、有效期、限速策略、复用策略（家庭/企业）。
- 流量池：
  - 企业维度建立池（按组织/项目/团队），可设置配额、阈值与到期策略。
  - 动态扩容与降级：基于使用曲线与预测模型自动调整；可设置审批流。
  - 实时使用监控与告警：分钟级/小时级更新；支持 API 与报表导出。
- 共享与限制：设备/订阅绑定策略、越权防护与风控（异常消耗、异常地理位置）。

### 5.3 批发与零售套餐管理

- 批发（Wholesale）：渠道批发价、分级折扣、合约期限、返利规则与结算周期。
- 零售（Retail）：面向终端用户的套餐销售、促销活动、优惠券与限时折扣。
- 渠道门户：合作伙伴登录、目录浏览、下单、库存申请与对账。
- 销售订单履约：订单拆解至 Profile 订购与激活码生成，跟踪履约状态与异常重试。

### 5.4 客户与订阅生命周期管理

- 客户档案：B2B（企业/部门/项目/成本中心）与 B2C（个人）信息与 KYC。
- 设备与 eUICC 管理：记录 EID、兼容性信息、终端类型与操作系统。
- 订阅生命周期：创建/下载/安装/启用/停用/删除，变更记录与审计。
- 多 Profile 管理：同一 eUICC 可保留多个 Profile 的策略（优先级、默认 Profile）。

### 5.5 财务管理

- 使用量采集与计费（Rating）：对接运营商 CDR/用量接口，支持不同计费维度与进位规则。
- 开票与税务：发票模板、多税率、多币种、跨境合规（增值税/销售税）。
- 支付与对账：支持 PayPal（国际版）/微信支付/支付宝/银行转账；支持后续扩展 Stripe；支付状态回调与账期管理。
- 对账与误差控制：与运营商用量、账单、发票与支付流水进行多维对账；支持自动/手动对账、差异标注与再计算；设定对账误差率目标 < 2%（按账期/月度），超阈值触发告警与复核流程。
- 审批与签章：对账完成后进入发票审批流（多级审批、加签/会签）；支持电子签章（DocuSign/Adobe Sign/链上签）与签章证书管理；签章后生成可校验 PDF。
- 结算与分润：渠道/运营商分成、结算单生成与核销。

企业批发支付流程监控（B2B）：

- 账单编号与关联：为每笔企业支付生成支付账单编号（与发票 invoiceId 一一关联），支持录入/匹配第三方交易号（如 PayPal OrderID、微信支付交易单号、支付宝交易号）。
- 支付凭证采集：支持上传多张支付截图/回单/水单，保存凭证 URL/附件标识，入库原始凭证并生成不可篡改哈希用于审计。
- 到账确认流程：引入收款确认状态（pending/confirmed/rejected），由财务或业务运营进行确认；记录确认人、确认时间与备注，支持再次复核与回滚。
- 对账与入账：收款确认成功后，自动与发票状态联动（Invoice.status=paid），写入审计日志；异常差异进入复核队列并触发告警。
- 通知与回调：为企业客户提供状态变更通知（邮件/Webhook），包含账单编号、发票编号、确认结果与凭证链接。

### 5.6 产品管理

- SKU 管理：基础产品（eSIM Profile 类目）与组合包（数据+有效期+区域）。
- 版本与上架：产品生命周期、上架/下架计划、灰度发布与渠道差异化。
- 促销与券：优惠券、满减、折扣码、限时活动，风控与核销规则。

### 5.7 市场竞价策略分析

- 数据采集：竞品价格、覆盖与质量指标、历史销量、季节性与节假日因子。
- 主流平台抓取：对淘宝/京东/拼多多/阿里巴巴/亚马逊/eBay/Shopee 等平台进行合规数据抓取，支持关键词/类目/区域过滤与任务化调度。
- 策略引擎：
  - 动态定价：基于成本、竞争强度、供需与赢率预测的最优出价建议。
  - 仿真与 A/B：对不同价格策略进行离线仿真与在线 A/B，输出提升与风险评估。
- 报表与监控：价格敏感度、毛利、转化率与留存分析。
- 审批与发布：定价策略支持提交审批、风控评审与合规检查，审批通过后按渠道与时窗发布，支持回滚与灰度策略。

### 5.8 库存与激活码管理

- 激活码池：生成、导入、分发、作废与过期管理；二维码/链接形式交付。
- 关联订阅与风控：绑定客户/订单/设备限制；防止批量滥用与盗刷。
- 可观测：激活码使用率、失败原因、重试次数与异常路径。

### 5.9 运维与客服

- 工单系统：创建/分派/处理/回访；与订阅状态联动。
- 运营任务：批量修复、脚本化重试、事件时间轴与 RCA（根因分析）。
- 知识库与常见问题：按设备品牌与 OS 汇总常见激活问题与指引。

### 5.10 报表与分析

- 标准报表：销量、用量、毛利、ARPU、留存、SLA、失败率等。
- 自定义查询与导出：CSV/JSON 导出与 API 查询；定时邮件或 Webhook 推送。
- CRM 与主数据相关指标（新增）：
  - 同步指标：同步吞吐（records/sec）、成功率/错误率、延迟分位（P95/P99）。
  - 映射覆盖率与冲突数量；重复记录合并率与人工复核耗时。
  - 连接器健康：外部 API 限流命中次数、重试次数、DLQ 堆积量与恢复耗时。

### 5.11 管理员与系统配置

- 安全策略：密码与密钥策略、会话时长、IP 白名单、API 限流、审计。
- 参数配置：税率、汇率、计费周期、告警阈值、审批流程、通知模板。
- 外部 CRM 连接器配置（新增）：OAuth 客户端（ClientId/Secret/Token URL）、字段映射模板、冲突策略（以平台为主/以外部为主/字段级别）、同步模式（单向/双向、增量/全量），限流与重试参数。

### 5.12 轻量 CRM 与主数据管理

- 客户主数据维护：
  - 基础档案：名称、类型（B2B/B2C）、行业、地址、联系人、KYC/合规资料。
  - 标签与备注：支持多标签分类与备注记录，便于市场与客服分层管理。
  - 变更记录与审计：客户信息变更留痕，可追溯与权限控制。
- 供应商（含运营商/渠道伙伴/第三方）主数据维护：
  - 基础档案：名称、类型（carrier/reseller/vendor）、资质/合同、联系人与支持区域。
  - 合规资料：证照/资质、有效期提醒与续签流程。
  - SLA/结算信息：SLA 指标、账期、结算方式与税务信息。
- 轻量 CRM 能力：
  - 联系人管理：角色（采购/技术/财务/客服等）、邮箱/电话、偏好与沟通记录。
  - 活动日志：与订单、工单、结算事件关联的互动记录（可导出）。
- 外部 CRM 接入与同步：

### 5.13 项目与研发过程管理（看板/燃尽图/工时监控）

- 目标：为研发与跨部门协作提供标准化看板、燃尽图与工时统计，并设计可复用的维度，后续用于市场与营收等多角度分析。
- 看板（Kanban）：
  - 看板实体可复用：支持绑定不同资源类型（tasks/bugs/epics/ops/marketing_campaign），并按 project/team/productLine/channel/campaign 等维度进行过滤与聚合。
  - 列与流程：支持自定义列（Backlog/In Progress/Code Review/Testing/Done）与在制品限制（WIP Limit）；定义迁移规则（列间流转校验）与自动化（例如进入“Testing”自动添加标签 test/qa）。
  - 卡片字段：id、title、description、assignee、labels、priority、storyPoints、estimateHours、remainingHours、status、dueDate、attachments（对接 /attachments 上传凭证，如设计方案/测试报告）。
  - 视图与筛选：支持泳道（按优先级/模块/负责人）、标签过滤、关键字搜索、排序；支持导出（CSV/JSON）与 API 查询。
  - 权限与可见性：看板可设为组织/团队/项目级可见；支持关注/订阅（通知与提醒）。
- 工时与时间统计（Time Tracking）：
  - WorkLog 记录：支持计时器/手动登记，字段包含 taskId、userId、startAt、endAt、duration、note、billable（可计费标记，后续对接营收/成本分析）。
  - 汇总报表：按用户/任务/标签/列/项目/看板维度汇总日/周/月工时，支持审批与修订历史；支持导出。
  - 预测与对比：计划工时（estimateHours）与实际工时（actualHours）对比；剩余工时（remainingHours）实时更新；支持超额/拖延告警与 SLA 配置。
- 燃尽图（Burndown）：
  - Sprint 定义：name、startDate、endDate、timezone、workingCalendar（节假日/非工作日）、目标度量（storyPoints/hours）。
  - 数据来源：按每日日切统计剩余工作量（remainingPoints/hours）、完成量（completed），支持排除非工作日与跨时区；支持 REST API（/sprints/{id}/burndown）。
  - 指标：Velocity、计划达成率、偏差（planned vs actual）、在制品趋势、平均完成时间（cycle/lead time）。
- 报表与复用（跨域分析）：
  - 通用维度：project、team、sprint、module、label、channel、campaign；可与支付/营收数据按时间与标签进行关联分析（示例：研发交付周期与市场活动收入的相关性）。
  - 标准报表：看板吞吐（Throughput）、WIP、平均/中位完成时长、瓶颈列识别、燃尽与燃起图、工时成本/产出比（结合 Payment/Invoice）。
  - 多端呈现：管理后台报表视图 + OpenAPI 提供原始数据/聚合数据查询；支持权限控制与租户隔离。
- 接口与安全（与 OpenAPI 对齐）：

  - 端点建议：/boards、/boards/{id}/columns、/tasks、/worklogs、/sprints、/sprints/{id}/burndown、/reports（看板与燃尽相关）。
  - OAuth2 Scopes：新增 boards:write、worklogs:write、reports:read（示例，具体以 openapi.yaml 为准）；写操作要求 Idempotency-Key；响应包含 X-Correlation-ID 与限流头。
  - 合规与留存：工时记录与报表留存策略（≥ 13 个月）；个人数据最小化与脱敏；导出与访问审计。

  #### 数据字典（摘要）

  - 客户（Customer）主数据：
    - 基本字段：id、name、type(B2B/B2C)、status、industry、region、tags、createdAt、updatedAt。
    - 联系方式：primaryEmail、primaryPhone、address（country/province/city/postcode/line1/line2）。
    - 账户关联：accountManagerId、billingAccountId、externalRefs（任意键值对，用于外部系统 ID）。
  - 供应商（Supplier）主数据：
    - 基本字段：id、name、supplierType(operator/channel/thirdParty)、status、country、partnerCode、settlementCycle、currency、createdAt、updatedAt。
    - 合规与合同：contractId、contractStatus、rateCardId、piiProcessor(true/false)。
  - 联系人（Contact）：
    - 基本字段：id、entityType(customer/supplier)、entityId、fullName、email、phone、title、department、isPrimary、createdAt、updatedAt。
  - 外部 CRM 绑定（ExternalCrmBinding）：
    - 基本字段：id、entityType、entityId、externalSystem(salesforce/hubspot/other)、externalId、fieldMappings、status(active/disabled)。
  - 同步作业（CrmSyncJob）：id、bindingId、direction(pull/push/bidirectional)、status、startedAt、finishedAt、errorCount、stats。

  注：完整字段与约束请参考 docs/数据模型.md 与 docs/api/openapi.yaml 中对应 schemas。

  #### 权限与范围矩阵（摘要）

  - 角色：
    - Admin：拥有所有 scopes，包括 suppliers:read/write、crm:read/write、integrations:write 等。
    - Operator Manager：crm:read、suppliers:read、suppliers:write（限所属运营商）、integrations:write（限 CRM 沙盒）。
    - Sales/CS：crm:read、crm:write（限联系人与客户主数据）、customers:read、orders:read。
    - Auditor：只读权限，包括 crm:read、suppliers:read、billing:read、payments:read，且具备审计查询能力。
  - OAuth2 Scopes（与 OpenAPI 对齐）：
    - suppliers:read / suppliers:write
    - crm:read / crm:write
    - integrations:write
  - 访问控制要点：
    - 按租户隔离（Tenant-Aware），用户的作用域与租户边界共同限制数据访问。
    - PII 最小化原则，默认屏蔽敏感字段，按需脱敏展示。
    - 审计日志记录读写行动（who/when/what），至少保存 13 个月。

  #### M2M（SM-DP/SM-SR）支持要点（规划）

  - 兼容 GSMA SGP.02/SGP.22 的基础接口差异与安全要求。
  - 明确区分 Consumer 与 M2M eUICC 生命周期管理差异（Profile 管理、激活与撤销流程）。
  - 对接运营商/供应商的 M2M 特有事件（批量激活、远程命令队列、异步状态回执）。
  - 支持批量操作的速率限制与幂等语义、长时间运行任务的状态查询与取消。
  - 合规：记录设备标识信息（IMEI/ICCID/EID/设备组），保护与脱敏策略，提供审计轨迹。

  验收（示例）：

  - 至少完成一个目标供应商的 M2M 沙盒对接（SM-DP/SM-SR），具备基本的 Profile 创建/下载/启用/禁用流程演示。
  - 批量激活 1000 条作业成功率 ≥ 98%，幂等重试后最终成功率 ≥ 99.5%。
  - 长跑任务（>30 分钟）具备进度/状态查询与取消能力，失败任务可自动重试 ≤3 次并进入 DLQ。
  - API 接入外部 CRM（如 Salesforce/HubSpot/Zoho 等），支持单向或双向同步。
  - 字段映射与冲突策略：可配置映射与优先级（以平台为主/以外部为主/字段级别），冲突标注与复核。
  - 同步模式：Webhook 推送、定时增量拉取、手动触发；失败重试与死信队列。
  - 安全与合规：OAuth2 客户端与令牌管理、审计日志、速率限制与数据脱敏。

## 6. 关键业务流程（BPMN/顺序说明）

### 6.1 运营商接入流程

1. 运营商提交企业与技术信息 → 资质审核 → 证书交换与 mTLS 配置。
2. 沙盒联调：下发测试 Profile、走通激活回调链路 → 验收成功。
3. 生产启用：价目表与库存导入、SLA 与监控配置、上线巡检。

### 6.2 零售激活流程（Consumer）

1. 用户下单 → 平台生成激活码（LPA:1$SM-DP+ 地址$MatchingID$…）与二维码。
2. 用户在支持 eSIM 的设备上通过 LPA 扫码 → 终端与 SM-DP+ 握手并下载 Profile。
3. SM-DP+→ 平台 Webhook：状态更新（可下载/已下载/已安装/已启用）。
4. 平台更新订阅状态与可视化报表；若失败，执行重试与客服联动。

### 6.3 企业批量激活与流量池

1. 企业管理员通过 CSV/API 提交批量设备与套餐绑定请求。
2. 平台按批次生成激活码或直接对接 SM-DP+ 下发 Profile 下载权限。
3. 设备激活成功后，订阅加入企业流量池并计入配额；达到阈值触发告警或自动扩容。

### 6.4 计费与财务闭环

1. 定时/实时拉取运营商用量（CDR/Streaming）。
2. Rating 引擎应用资费规则，生成周期账单与发票；支付网关回调状态。
3. 渠道/运营商结算单生成与对账；异常差异标记与复核流程。

### 6.5 退订/停用/删除

1. 用户或管理员提交停用/删除请求 → 平台调用运营商接口 → Webhook 更新。
2. 计费停止与最终结算；保留必要审计与合规记录。

## 7. 接口集成要求

- 网络与安全：全链路 HTTPS + mTLS，证书与密钥通过安全仓库/硬件加密模块管理。
- 协议与幂等：对外 REST/gRPC，关键写操作需幂等键；接入运营商 Webhook 回调与重试机制。
- 限流与熔断：API Gateway 实施速率限制与熔断策略；重试需指数退避与死信队列。
- 版本与兼容：接口版本化管理，兼容多家运营商的差异字段与流程。

## 8. 非功能需求（NFR）

- 安全：
  - 身份与鉴权：OAuth2/OIDC、RBAC、细粒度资源权限；审计日志不可篡改。
  - 数据安全：敏感字段加密（EID/匹配信息）、静态与传输加密、脱敏展示。
  - 合规：GDPR/CCPA/本地隐私法；数据主权与跨境传输控制。
  - 项目性质与访问边界：企业内部项目，不对外公开；接口仅用于内网调用与契约测试；默认拒绝外网访问（网关与防火墙策略）。
  - 访问控制与网关：API 网关统一鉴权与限流；支持 IP 白名单/VPN/零信任访问策略；所有请求必须携带 X-Request-ID，服务端生成/透传 X-Correlation-ID 用于审计。
  - 速率限制与退避：触发限流时统一返回 429 Too Many Requests，并附带 Retry-After 响应头；客户端须按 Retry-After 进行指数退避重试。详见 docs/api/openapi.yaml 中 /market/crawl-jobs 端点的错误响应约定。
  - Webhook 安全：SM-DP+ 回调必须携带签名与时间戳（X-SMDP-Signature/X-SMDP-Timestamp），校验失败或重放拒绝。
  - 密钥与证书：密钥/证书由 Vault/HSM 管理；双向 mTLS，证书轮换与过期提醒自动化。
- 可用性与恢复：
  - 目标可用性 ≥ 99.95%；双可用区/多区域部署；RPO ≤ 15 分钟，RTO ≤ 1 小时。
  - 备份与演练：每日备份、季度演练；灾备切换自动化。
- 性能与容量：
  - 激活峰值并发：≥ 5k req/min（可水平扩展）；Webhook 吞吐与有序处理。
  - 报表查询响应：P95 ≤ 2s；批量任务队列可扩展至百万级。
- 可观测与运维：
  - 指标：成功率、延迟、失败原因分布、库存余量、告警命中率。
  - 日志与追踪：集中日志、分布式追踪、事件时间轴；SLA 报表与周报。
- 国际化与本地化：多语言 UI、多币种、多税制；时区与节假日策略。

## 9. 合规与标准遵循

- GSMA eSIM RSP 架构：Consumer（SM-DP+/SM-DS）与 M2M（SM-DP/SM-SR）组件与流程。
- 激活码规范：支持 LPA 激活码格式与二维码分发；EID/MatchingID 管理与校验。
- 证书与密钥：双向 TLS、证书轮换、过期提醒与自动化续签流程。
- 审计与留存：操作、状态变更、财务票据、风控事件等按法规留存。
- 本地法律法规：电信许可、KYC 要求、税务与发票合规、跨境数据传输限制。

## 10. 验收标准（示例）

- 沙盒运营商至少 1 家，走通完整零售激活流程与 Webhook 追踪，成功率 ≥ 99%。
- 企业批量激活支持 CSV 导入与 API 两种方式，错误报告清晰，可重试。
- 流量池阈值告警与自动扩容策略可配置且生效，报表可回溯。
- 计费引擎能正确对账运营商用量数据，生成发票并完成支付流程。
- 财务对账误差率（账单/用量/支付流水综合）< 2%，超阈值有告警与复核记录，并可追溯差异处理过程。
- 安全与合规检查清单通过（渗透测试、审计、证书轮换演练）。
- 外部 CRM 集成（新增）：完成至少 1 种外部 CRM（如 Salesforce/HubSpot）沙盒对接；

  - 双向同步成功率 ≥ 98%，在 API 限流条件下单记录重试次数 ≤ 3；
  - 字段映射覆盖率 ≥ 95%，冲突处理具备审计与复核记录；
  - 重复记录合并准确率 ≥ 95%，支持人工干预与回滚；
  - 同步作业支持断点续传与状态查询（jobId），DLQ 可观测并可恢复。

- API 通用能力（新增）：
  - OpenAPI 版本为 3.1.x，规范校验通过（无严重诊断错误）。
  - 通用请求头：支持并记录 X-Request-ID，服务端响应透传/生成 X-Correlation-ID。
  - Webhook 安全：SM-DP+ 回调需携带签名与时间戳（X-SMDP-Signature/X-SMDP-Timestamp），签名校验与重放防护生效。
  - 幂等性：写操作在并发与重试条件下，幂等冲突率 ≤ 0.5%；Idempotency-Key 生效且可审计。
  - 统一错误模型：ErrorResponse 在 4xx/5xx 场景均使用且包含 requestId；错误码字典齐备（≥ 90% 端点覆盖）。
  - 速率限制：X-RateLimit-\* 响应头返回并与实际策略一致；超过限额时返回标准错误码与重试提示。
  - 契约测试：主路径端点契约测试覆盖率 ≥ 80%，Webhook 契约测试至少 1 条成功与 1 条失败用例。

## 11. 风险与假设

- 不同运营商接口差异大，需做兼容层与配置化适配。
- 设备与 OS 版本差异导致 LPA 行为不同，需维护知识库与回退策略。
- 用量数据延迟或缺失影响计费准确性，需要补偿与人工复核流程。
- 跨境支付与税务复杂，需引入本地化合规顾问并分阶段上线。

## 12. 里程碑（参考）

- M0（4 周）：沙盒接入与最小可用激活流程（零售单订阅）。
- M1（8-10 周）：企业流量池、批量激活、基础计费与开票。
- M2（12-16 周）：批发渠道门户、动态定价、全面报表与合规审计。
- M3（>16 周）：多区域部署、SLA 达标、性能优化与成本优化。

## 13. 多语言与国际化（i18n）需求（新增）

### 13.1 目标

- 为系统提供一致的多语言体验，首期支持中英文（zh-CN/en-US），覆盖 UI 文案、日期时间与时区、数字与货币格式化、错误提示与校验信息，使不同地区用户均可无障碍使用。

### 13.2 范围与支持语言

- 支持语言：
  - zh-CN（简体中文，默认）
  - en-US（美式英语）
- 覆盖范围：
  - 前端管理台（菜单、导航、按钮、提示、表单校验、空态与错误页）。
  - 业务页面（订阅、发票、财务、报表、运营商接入等）主流程按钮与提示。
  - 导出文件（CSV/XLSX/PDF）中的表头与常用标签（如“发票编号/Invoice No.”）。
  - 通知模版（邮件/短信/站内）支持按租户/用户语言渲染。

### 13.3 用户故事

- 作为中国区企业管理员，我希望默认以中文展示系统，并可以在右上角切换为英文，以支持跨区沟通。
- 作为海外渠道运营，我希望所有金额以 USD 显示且日期采用当地时区与英文格式，便于理解与对账。
- 作为财务人员，我希望导出的发票 PDF 与报表可选择语言，以支持对外披露与合规审计。

### 13.4 文案分类与键命名规范

- 分类：
  - 通用（common）：通用按钮与提示，如 common.ok、common.cancel、common.back、common.search。
  - 布局（layout）：导航、面包屑、设置项，如 layout.logout、layout.openSettings。
  - 领域（domain）：订阅/发票/订单等，如 invoice.detail.title、invoice.actions.approve、subscription.detail.back。
  - 校验（validate）：必填/格式错误/长度超限，如 validate.required、validate.email、validate.lengthRange。
- 键命名规则：
  - 使用“模块.子模块.语义”三级结构，避免动态拼接（如 invoice.actions.downloadPdf）。
  - 禁止在代码中写死中文/英文，统一使用 i18n 键。
  - 变更需更新两种语言版本并通过校验工具（缺失键检查）。

### 13.5 业务格式化要求

- 货币与税率：
  - 显示使用 Intl.NumberFormat，按语言与地区格式化（en-US 使用小数点与千分位，zh-CN 使用中文单位与格式）。
  - 币种显示按照租户/账户偏好（CNY/USD/EUR 等），金额展示与计算保持一致性（两位小数，税额与总额分别显示）。
- 数字：
  - 千分位与小数位按语言格式化；百分比显示统一至两位（可配置）。
- 日期时间与时区：
  - 所有日期时间展示采用用户偏好时区（从账户设置与浏览器推断），使用 ISO 与本地化格式（如 2025-10-29 14:30:00 / Oct 29, 2025, 2:30 PM）。
  - 导出报表与发票需记录时区与生成时间，保证审计一致性。
- 姓名与地址格式：
  - 姓名显示支持中英文不同顺序（zh-CN：姓在前；en-US：名在前）。
  - 地址模板按地区标准（省/州、邮编、城市顺序）。
- 联系方式：
  - 电话、邮箱校验消息可本地化；掩码格式展示遵循地区惯例。
- RTL 兼容：
  - 首期不引入阿拉伯语等 RTL 语言；保留样式与组件兼容空间，后续可扩展。

### 13.6 语言切换与持久化

- 入口：导航栏右上角提供语言下拉（中文/English）。
- 持久化：选择的语言写入本地存储并在登录后按用户偏好加载；路由切换与页面刷新后仍生效。
- 兜底策略：
  - 当某键缺失时回退至默认语言（zh-CN），同时在开发环境输出缺失警告。

### 13.7 文案管理与翻译流程

- 文案变更流程：产品提出 → 设计确认 → 文案库更新（两种语言）→ 前端引用键 → 自测与缺失键扫描 → 联调验收。
- 翻译来源：
  - 首期由内部维护（PM/开发）完成；支持后续接入外部翻译平台（如 POEditor/Crowdin）。
- 版本化：所有文案文件纳入版本控制，新增/删除键需更新变更日志与差异清单。

### 13.8 验收标准

- 覆盖率：已上线菜单与发票、订阅相关页面的 UI 文案与操作提示 i18n 键覆盖率 ≥ 95%。
- 切换体验：语言切换后页面即时更新，无需刷新；持久化生效。
- 格式化一致性：金额/税率、日期时间在中英语言下展示正确；导出文件语言可选并与 UI 一致。
- 缺失键检查：构建或开发时运行缺失键扫描，无缺失或仅允许 ≤ 5 条低风险警告（并需在后续迭代补齐）。

### 13.9 非功能约束（NFR）

- 性能：加载语言包采用按需与懒加载策略，首屏不超过 5% 额外体积；切换语言不超过 200ms。
- 可维护性：键命名统一且有字典；新增页面必须同时提交中英文文案。
- 安全与合规：导出文件语言选择需记录在审计日志；对外披露文件需遵循本地法规与语言要求。

### 13.10 风险与治理

- 风险：文案散落导致漏翻；硬编码中文影响国际化。
- 治理：
  - 在 CI 增加缺失键与未使用键检查；禁止硬编码中文/英文的 lint 规则（允许极少数不可国际化的技术词）。
  - 建立文案评审流程，重要页面需评审通过后方可合入。
